iTorr.ua=function(b){b=b||navigator.userAgent;return b.match(/Windows Phone/i)?"Mango":b.match(/Windows CE/i)?"winCE":b.match(/ipad/i)?"iPad":b.match(/iPod/i)?"Touch":b.match(/iphone/i)?"iPhone":b.match(/android/i)?"Android":b.match(/Ubuntu/i)?"Ubuntu":b.match(/Mac OS X/i)?"Mac OS X":b.match(/360/i)?"Shit!":b.match(/opera minf/i)?"Opera mini":b.match(/Chrome/i)?"Cr":b.match(/Safarf/i)?"Safari":b.match(/Opera/i)?"Opera":b.match(/UCWEB/i)?"UC":b.match(/PHP/i)?"PHP":"";};String.prototype.enHtml=function(){return this.replace(/(^\s*)|(\s*$)/g,"").replace(/(http\:\/\/[0-9A-Za-z\/.#&!?%:;=_]+\.)(gif|jpg|jpeg|png)/g,'<img src="$1$2">').replace(/(http\:\/\/ww[0-9]{1}\.sinaimg\.cn\/)([\w]{4,10})(\/[\w]{16,32}\.)(gif|jpg|jpeg|png)/g,"$1mw1024$3$4").replace(/http:\/\/www\.xiami\.com\/song\/([0-9]{5,12})[\?\w\.\=]*/g,'<a href="//www.xiami.com/song/$1" target="_blank" class="xiami">http://www.xiami.com/song/$1</a>').replace(/(@)([\u4e00-\u9fa5\u0800-\u4e00A-Za-z0-9\-_]{2,32})/g,'<b class="at">$1$2</b>').replace(/(^|[^\"\'\]>])(http|ftp|mms|rstp|news|https|telnet)\:\/\/([0-9A-Za-z\/.#&!?%:;=\-_]+)/g,'$1<a href="$2://$3" rel="external nofollow noreferer" class="link" target="_blank">$2://$3</a>').replace(/\n/g,"<br>");};$.lcss("i/cmts.css");var cmt=function(c){var d=function(a,b){if(b){window.localStorage?localStorage.setItem(a,b):c.cookie(a,b);}else{return window.localStorage?localStorage.getItem(a):c.cookie(a);}};return cmt={load:function(a){Q.x("cmt","x/?a=c&id="+a,function(f){for(var b in f){f[b].ua=c.ua(f[b].agent);if(!f[b].url){delete f[b].url;}f[b].date=c.re_date(f[b].created);f[b].html=f[b].text.enTxt();}return{pid:a,c:f};},function(h){c(".cmt").innerHTML=h;var j=c(".cmt form"),i=c.S(".cmt form input,.cmt form textarea");c(".cmt ul").onclick=function(f){f=f||window.event;var e=f.srcElement||f.target;if(e.className=="fo"){j.text.focus();j.text.value+="@"+e.getAttribute("data-name")+" ";}};for(var h in i){var b=i[h];if(b.type=="hidden"){continue;}b.onfocus=b.onchange=b.onkeypress=b.onkeyup=b.onkeydown=function(){d("cmtU"+this.name,this.value);};b.value=d("cmtU"+b.name)||b.value;}j.text.onfocus=j.text.onchange=j.text.onkeypress=j.text.onkeyup=function(){d("cmTypeV",this.value);var e=this.value.match(/\n/g)||[];this.setAttribute("rows",e.length+5);};j.text.value=d("cmTypeV")||"";j.text.onkeydown=function(){j.text.onkeyup();if(window.event.ctrlKey&&window.event.keyCode==13){j.onsubmit();return false;}};j.onsubmit=function(){for(var g in i){var f=i[g];if(f.required&&(!f.value||(f.type=="email"&&!f.value.match(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/))||(f.type=="url"&&!f.value.match(/^http[s]?:\/\/([\w-]+\.)+[\w-]+([\w-.\/?%&=]*)?$/)))){alert("请输入正确的"+f.title);f.focus();return false;}}var e=[];for(var g=0,l=i.length;g<l;g++){var f=i[g];console.log(f);e.push(f.name+"="+encodeURIComponent(f.value));}c.x("x/?a=addc",e.join("&"),function(m){var k=c.D.m("li");k.className="C-li a";k.innerHTML='	<div class="DS-post">		<a class="user" href="'+m.url+'" target="_blank">			<img class="avatar" src="http://gravatar.duoshuo.com/avatar/'+m.avatar+'?s=50">			'+m.author+'		</a>		<span class="agent">'+c.ua(m.agent)+'</span>		<p class="msg">'+m.text.enHtml()+'</p>		<div class="ctrl">			<span>2013年7月23日</span>			<span class="fo" data-name="'+m.author+'">回应</span>		</div>	</div></li>';c.D.a(c(".cmt ul"),k);j.text.value="";d("cmTypeV","");window.scrollTo(0,k.offsetTop);});return false;};});}};}(iTorr);